<div>
    <input type="file" id="picture-selector" multiple="true" accept="image/png, image/jpeg">
    <button id="paste-picture">粘贴图片</button>
    <button id="paste-background">粘贴背景</button>
</div>

<script>
    let inputEle = document.getElementById('picture-selector');
    let btnPastePic = document.getElementById('paste-picture');
    let btnPasteBg = document.getElementById('paste-background');

    let picData = []

    function reset() {
        picData = []
        btnPastePic.disabled = true
        btnPasteBg.disabled = true
    }

    inputEle.onchange = async function () {
        reset()
        const files = inputEle.files;
        for (let i = 0; i < files.length; i++) {
            let fileReader = new FileReader();
            fileReader.onload = function (e) {
                let uint8Array = new Uint8Array(e.target.result);
                // picData.push(uint8Array)
                picData[i] = uint8Array
            };
            fileReader.onloadend = function () {
                if (i === files.length - 1) {
                    btnPastePic.disabled = false
                    btnPasteBg.disabled = false
                }
            };
            fileReader.onerror = function (e) {
                console.log(`【读取错误】${i}`)
            };
            fileReader.readAsArrayBuffer(files[i])
            console.log(`【读取文件】[${i}] -- (${files[i].name})`)
        }
    }

    document.getElementById('paste-picture').onclick = function () {
        picData.forEach((picBytes, index, array) => {
            parent.postMessage({
                pluginMessage: {
                    type: 'paste-picture',
                    prefix: 'qy-pic',
                    index: index,
                    total: array.length,
                    picBytes: picBytes,
                    // end: index === array.length - 1,
                }
            }, '*')
        })

    };

    document.getElementById('paste-background').onclick = function () {
        picData.forEach((picBytes, index, array) => {
            parent.postMessage({
                pluginMessage: {
                    type: 'paste-picture',
                    prefix: 'qy-bg',
                    index: index,
                    total: array.length,
                    picBytes: picBytes,
                    // end: index === array.length - 1,
                }
            }, '*')
        })
    };

</script>
